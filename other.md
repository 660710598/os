1) javac ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

javac = Java Compiler

‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡∏Ñ‡∏≠‡∏°‡πÑ‡∏û‡∏•‡πå (compile) ‡πÑ‡∏ü‡∏•‡πå .java (source code) ‚Üí ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå .class (bytecode)

2) .class ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

‡πÑ‡∏ü‡∏•‡πå .class ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö .java ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô bytecode ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Java Virtual Machine (JVM)

JVM ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô ‡πÑ‡∏ü‡∏•‡πå .class ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á java---
------------------------------------------------------------------------------------------------------------------
‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üôå ‡∏ú‡∏°‡∏à‡∏∞‡∏ß‡∏≤‡∏î **diagram ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô `RandomAccessFile ‚Üí FileChannel ‚Üí MappedByteBuffer ‚Üí Shared Slots`** ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û

---

## üîπ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

```
 Process 1              Process 2              Process 3
    |                      |                      |
    |                      |                      |
RandomAccessFile       RandomAccessFile       RandomAccessFile
   ("rw")                 ("rw")                 ("rw")
    |                      |                      |
    | getChannel()         | getChannel()         | getChannel()
    v                      v                      v
  FileChannel  --------- Shared File ---------  FileChannel
 ("heartbeat_shared.dat")  (disk)          ("heartbeat_shared.dat")
    |                      |                      |
    | map(...)             | map(...)             | map(...)
    v                      v                      v
MappedByteBuffer <------ Memory Mapping ------> MappedByteBuffer
    |                      |                      |
    | write slot (PID=1)   | write slot (PID=2)   | write slot (PID=3)
    |                      |                      |
    +-------> Shared Memory Slots (‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå) <------+
```

---

## üîπ Shared Memory Layout (`REGION_SIZE = 128`)

‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô **slot** (128 byte ‡∏ï‡πà‡∏≠ slot):

| Slot | ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∞‡πÑ‡∏£ | Offset ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡∏ä‡πà‡∏ß‡∏á byte |
| ---- | ---------- | --------------- | --------- |
| 0    | Boss info  | 0               | 0‚Äì127     |
| 1    | PID 1      | 128             | 128‚Äì255   |
| 2    | PID 2      | 256             | 256‚Äì383   |
| 3    | PID 3      | 384             | 384‚Äì511   |

---

## üîπ ‡∏ó‡∏≥‡πÑ‡∏°‡∏°‡∏±‡∏ô‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å

1. **‡∏ó‡∏∏‡∏Å process ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‚Üí ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏ä‡∏£‡πå‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ú‡πà‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
2. **`RandomAccessFile` + `FileChannel.map`** ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô memory ‡∏ó‡∏µ‡πà map ‡πÄ‡∏Ç‡πâ‡∏≤ address space ‡∏Ç‡∏≠‡∏á process ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß
3. **‡πÅ‡∏ï‡πà‡∏•‡∏∞ process ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ slot ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á** (`pid * REGION_SIZE`) ‚Üí ‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Å‡∏±‡∏ô
4. **‡∏ó‡∏∏‡∏Å process ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô slot ‡∏Ç‡∏≠‡∏á process ‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ** ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô heartbeat monitor

---

üìå ‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢ ‡πÜ

* `RandomAccessFile` = ‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå
* `FileChannel` = ‡∏ó‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå
* `MappedByteBuffer` = ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© memory ‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å process ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
* `Shared Slots` = ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡πà‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞ process

------------------------------------------------------------------------------------------------------------------


‡∏ó‡∏≥‡πÑ‡∏°‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `offset = otherPid * REGION_SIZE` ‡πÅ‡∏•‡∏∞ process ‡∏ñ‡∏∂‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ **‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡πÉ‡∏ô shared memory**

---

## üîπ ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á shared memory

* ‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat` ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô **slot**
* ‡πÅ‡∏ï‡πà‡∏•‡∏∞ process ‡∏à‡∏∞‡∏°‡∏µ slot ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏ô memory file)
* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ slot = `REGION_SIZE` (‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πá‡∏ô 128 byte)
* ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô memory = `slot index * REGION_SIZE`

---

## üîπ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤ `NUM_PROCESSES = 3`

* `REGION_SIZE = 128`
* ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ layout ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat`:

| Process | Offset ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô | ‡πÉ‡∏ä‡πâ memory (byte) |
| ------- | --------------- | ----------------- |
| PID 1   | `1 * 128 = 128` | 128‚Äì255           |
| PID 2   | `2 * 128 = 256` | 256‚Äì383           |
| PID 3   | `3 * 128 = 384` | 384‚Äì511           |

(*‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà index 0 ‡∏°‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö boss election*)

---

## üîπ ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á heartbeat

* `HeartbeatSender` ‡∏Ç‡∏≠‡∏á process `pid` ‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á **slot ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á**:

  ```java
  int offset = pid * REGION_SIZE;
  ```

  ‡πÄ‡∏ä‡πà‡∏ô PID=2 ‚Üí `offset = 2*128 = 256` ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô heartbeat ‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà byte 256‚Äì383

---

## üîπ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ü‡∏±‡∏á heartbeat

* `HeartbeatListener` ‡∏Ç‡∏≠‡∏á PID=1 ‡∏à‡∏∞‡∏ß‡∏ô‡∏î‡∏π‡∏ó‡∏∏‡∏Å process (2..N) ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì offset:

  ```java
  int offset = otherPid * REGION_SIZE;
  ```

  ‡∏ñ‡πâ‡∏≤ otherPid=2 ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà byte 256‚Äì383
  ‡∏ñ‡πâ‡∏≤ otherPid=3 ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà byte 384‚Äì511

---

## üîπ ‡∏ó‡∏≥‡πÑ‡∏° process ‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ slot ‡∏Ç‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô?

‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î **‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô** ‡πÑ‡∏ß‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô:

1. ‡∏ó‡∏∏‡∏Å process ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (`heartbeat_shared.dat`)
2. ‡∏Ç‡∏ô‡∏≤‡∏î slot ‡∏ï‡πà‡∏≠ process ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (`REGION_SIZE`)
3. index ‡∏Ç‡∏≠‡∏á slot = `pid`

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÅ‡∏Ñ‡πà‡∏£‡∏π‡πâ `pid` ‚Üí ‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ slot ‡∏Ç‡∏≠‡∏á process ‡∏ô‡∏±‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô‡πÉ‡∏ô memory

---

üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ

* `offset = pid * REGION_SIZE` = ‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Å‡∏±‡∏ô
* ‡∏ó‡∏∏‡∏Å process ‡∏£‡∏π‡πâ‡∏™‡∏π‡∏ï‡∏£‡∏ô‡∏µ‡πâ ‚Üí ‡πÄ‡∏•‡∏¢‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÑ‡∏´‡∏ô
* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô shared memory ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö

---------------------------------------------------------------------------------------------------------------------


```java
RandomAccessFile raf = new RandomAccessFile(SHARED_FILE, "rw");
```

---

## üîé ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô

### üîπ `RandomAccessFile`

* ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏•‡∏≤‡∏™‡πÉ‡∏ô Java (`java.io.RandomAccessFile`)
* ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå** ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:

  * ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ byte
  * ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ byte
  * **‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏î ‡πÜ ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (seek)** ‚Üí ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÅ‡∏ö‡∏ö `FileInputStream` ‡∏´‡∏£‡∏∑‡∏≠ `FileReader`
* ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ **shared memory ‡πÅ‡∏ö‡∏ö slot** (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ process ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞ slot ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)

---

### üîπ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå `(SHARED_FILE, "rw")`

* `SHARED_FILE` ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ `"heartbeat_shared.dat"`)
* `"rw"` ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå:

  * `"r"` = read-only ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  * `"rw"` = read + write ‚Üí **‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ**
  * `"rws"` / `"rwd"` = ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö sync ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤)

**‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô `"rw"` = ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ process ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ**

---

### üîπ ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `raf`

* ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ `raf` ‡∏Ñ‡∏∑‡∏≠‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat`
* ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á:

  ```java
  raf.seek(128);           // ‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î‡πÑ‡∏õ byte ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 128
  raf.write("Hello".getBytes());  // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô "Hello" ‡∏ï‡∏£‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ô‡∏±‡πâ‡∏ô
  raf.seek(128);
  int b = raf.read();      // ‡∏≠‡πà‡∏≤‡∏ô 1 byte
  ```
* ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Üí `raf` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏á ‡πÜ
  ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á `FileChannel`

---

### üîπ ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö `FileChannel`

```java
FileChannel channel = raf.getChannel();
this.buffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, size);
```

* `raf.getChannel()` ‚Üí ‡∏î‡∏∂‡∏á **FileChannel** ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤
* ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ `map(...)` ‚Üí ‡πÅ‡∏°‡πá‡∏û‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤ **‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ (MappedByteBuffer)**
* ‡∏ú‡∏•‡∏Ñ‡∏∑‡∏≠ process ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏Å‡πá‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡πà‡∏≤‡∏¢ ‡πÜ

`RandomAccessFile raf = new RandomAccessFile(SHARED_FILE, "rw");`
\= ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå `heartbeat_shared.dat` ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏≠‡πà‡∏≤‡∏ô+‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Java process ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô (backing file) ‡∏Ç‡∏≠‡∏á **shared memory** ‡∏ó‡∏µ‡πà process ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô

----------------------------------------------------------------------------------------------------------------------------------------------------------

‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‚ú® ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ **`MappedByteBuffer`** ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á *shared memory* ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏•‡∏¢

---

## üîé `MappedByteBuffer` ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

* ‡πÄ‡∏õ‡πá‡∏ô **‡∏Ñ‡∏•‡∏≤‡∏™‡πÉ‡∏ô Java (java.nio.MappedByteBuffer)**
* ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ **map (‡πÅ‡∏°‡πá‡∏û) ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ (memory)** ‡∏ú‡πà‡∏≤‡∏ô `FileChannel.map(...)`
* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡πÅ‡∏°‡πá‡∏û ‚Üí ‡∏à‡∏∞‡πÑ‡∏î‡πâ buffer ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô **‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå‡∏Ç‡∏≠‡∏á byte**
* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ñ‡∏∑‡∏≠:

  * ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô `MappedByteBuffer` = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  * ‡πÅ‡∏•‡∏∞ process ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πá‡∏û‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πá‡∏à‡∏∞ **‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô** (‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞ shared memory!)

---

## üîπ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á

```java
RandomAccessFile raf = new RandomAccessFile("heartbeat_shared.dat", "rw");
FileChannel channel = raf.getChannel();

// map ‡∏Ç‡∏ô‡∏≤‡∏î 512 bytes
MappedByteBuffer buffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, 512);
```

* `"rw"` ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô+‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ
* `map(FileChannel.MapMode.READ_WRITE, 0, 512)` ‚Üí

  * READ\_WRITE = ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ
  * `0` = offset ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå
  * `512` = ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà map ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô memory

---

## üîπ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö array ‡∏Ç‡∏≠‡∏á byte ‡πÄ‡∏•‡∏¢

```java
// ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á buffer
String msg = "PID:1 alive " + System.currentTimeMillis();
byte[] data = msg.getBytes(StandardCharsets.UTF_8);

buffer.position(128);            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á offset = 128
buffer.put(data);                // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á memory (‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå)

// ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
byte[] readBytes = new byte[128];
buffer.position(128);
buffer.get(readBytes, 0, 128);

String msg2 = new String(readBytes, StandardCharsets.UTF_8).trim();
System.out.println("Read: " + msg2);
```

---

## üîπ ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `MappedByteBuffer`?

1. **‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ I/O ‡∏õ‡∏Å‡∏ï‡∏¥**
   ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å map ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ OS ‡πÅ‡∏•‡πâ‡∏ß
2. **‡∏´‡∏•‡∏≤‡∏¢ process ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ**
   Process ‡πÑ‡∏´‡∏ô ‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `MappedByteBuffer` ‚Üí ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö *real-time*
3. **‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏ö‡∏ö random access**
   ‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô/‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á offset ‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ (‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ slot per process)

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ

`MappedByteBuffer` = ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πá‡∏û‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡∏ó‡∏≥‡πÉ‡∏´‡πâ process ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô **shared memory**

* ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô string ‡∏•‡∏á buffer ‚Üí ‡∏≠‡∏µ‡∏Å process ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
* ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡πÑ‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö **heartbeat + boss election** ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏≠‡∏¢‡∏π‡πà

---





